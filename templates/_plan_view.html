<div class="row d-flex">
    <div class="col-md-4">
        <h5>Itinerary</h5>
        {% if plan.days %}
            {% set total_estimated_cost = namespace(value=0) %}
            {% for day in plan.days %}
                <h4 class="mt-4">{{ day.date.strftime('%Y-%m-%d') }}</h4>
                <div class="list-group">
                    {% for item in day.items %}
                        <div class="list-group-item mb-2" onclick="toggleActualCosts('{{ item.id }}')" style="cursor: pointer;">
                            <h5 class="mb-1">{{ item.item_type }}: {{ item.description }}</h5>
                            <small>Start: {{ item.start_time.strftime('%H:%M') if item.start_time else 'N/A' }}</small>
                            <small>End: {{ item.end_time.strftime('%H:%M') if item.end_time else 'N/A' }}</small>
                            <p class="mb-1">Estimated Cost: {{ "%.2f"|format(item.estimated_cost) }} {{ item.estimated_cost_currency }}</p>
                            {% if item.location %}
                                <p class="mb-1">Location: {{ item.location.name }}</p>
                            {% endif %}
                        </div>
                        {% if is_details_view %}
                        <div id="actual-costs-{{ item.id }}" class="list-group-item mb-2" style="display: none;" onclick="event.stopPropagation();">
                            <p class="mb-1 mt-2">Actual Costs:</p>
                            <ul>
                                {% for cost in item.actual_costs %}
                                    <li class="d-flex justify-content-between align-items-center">
                                        {{ cost.name }}: {{ "%.2f"|format(cost.amount) }} {{ cost.currency }}
                                        <form action="{{ url_for('delete_actual_cost_route', cost_id=cost.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this cost?');">
                                            <input type="hidden" name="plan_id" value="{{ plan.id }}">
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                    </li>
                                {% endfor %}
                            </ul>
                            <hr>
                            <h6>Add New Cost</h6>
                            <form action="{{ url_for('create_actual_cost_route', item_id=item.id) }}" method="post">
                                <input type="hidden" name="plan_id" value="{{ plan.id }}">
                                <div class="row">
                                    <div class="col">
                                        <input type="text" name="name" class="form-control" placeholder="Name" required>
                                    </div>
                                    <div class="col">
                                        <input type="number" name="amount" class="form-control" placeholder="Amount" required step="0.01">
                                    </div>
                                    <div class="col">
                                        <input type="text" name="currency" class="form-control" placeholder="Currency" required>
                                    </div>
                                    <div class="col">
                                        <button type="submit" class="btn btn-primary btn-sm">Add</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
            <hr>
            <h4>Total Estimated Cost: {{ "%.2f"|format(total_estimated_cost.value) }}</h4>
        {% else %}
            <p>No itinerary items for this plan.</p>
        {% endif %}
    </div>
    <div class="col-md-8">
        <div class="card h-100">
            <div class="card-body p-0">
                <div id="container" style="height: 100%; min-height: 600px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleActualCosts(itemId) {
    var x = document.getElementById("actual-costs-" + itemId);
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}
</script>

<!-- Map Scripts -->
<script src="https://webapi.amap.com/maps?v=1.4.15&key={{ amap_key }}"></script>
<script>
    var map = new AMap.Map('container', {
        resizeEnable: true, //是否监控地图容器尺寸变化
        zoom: 10, //初始化地图层级
        center: [116.397428, 39.90923] //初始化地图中心点
    });
</script>


